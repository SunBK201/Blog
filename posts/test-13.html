<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>aaaaaaaaaaaaaaaaadaccaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</title>
  <meta name="author" content="Jorengarenar">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="https://joren.ga/avatar.svg">
  <link rel="stylesheet" href="/style.css">
  <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Jorengarenar">
</head>
<body>
  <header>
    <h1><a rel="author" href="/">Jorengarenar</a></h1>
    <nav>
      <a href="https://joren.ga">About</a>
      <a href="/feed.xml">RSS</a>
    </nav>
  </header>
  <main>
<header>
  <time datetime="2020-12-13T00:00:00+00:00"> 2020-12-13 </time>
  <h1>Make Vim follow XDG Base Directory specification</h1>
</header>

<p>XDG Base Directory specification, <code>$XDG_CONFIG_HOME</code> etc. Great thing - configs
separated from user data and cache, no clutter in home directory. Unfortunately,
many programs still don't respect it, including Vim. But what would be our favourite
text editor if we wouldn't be able to reconfigure it!</p>

<h1 id="tldr">TL;DR</h1>

<p>Into shell config (e.g. in <code>~/.profile</code>):</p>
<pre><code class="language-sh">export VIMINIT="set nocp | source ${XDG_CONFIG_HOME:-$HOME/.config}/vim/vimrc"
</code></pre>

<p>At the top of <em>vimrc</em>:</p>
<pre><code class="language-vim">" XDG support

if empty($MYVIMRC) | let $MYVIMRC = expand('&lt;sfile&gt;:p') | endif

if empty($XDG_CACHE_HOME)  | let $XDG_CACHE_HOME  = $HOME."/.cache"       | endif
if empty($XDG_CONFIG_HOME) | let $XDG_CONFIG_HOME = $HOME."/.config"      | endif
if empty($XDG_DATA_HOME)   | let $XDG_DATA_HOME   = $HOME."/.local/share" | endif
if empty($XDG_STATE_HOME)  | let $XDG_STATE_HOME  = $HOME."/.local/state" | endif

set runtimepath^=$XDG_CONFIG_HOME/vim
set runtimepath+=$XDG_DATA_HOME/vim
set runtimepath+=$XDG_CONFIG_HOME/vim/after

set packpath^=$XDG_DATA_HOME/vim,$XDG_CONFIG_HOME/vim
set packpath+=$XDG_CONFIG_HOME/vim/after,$XDG_DATA_HOME/vim/after

let g:netrw_home = $XDG_DATA_HOME."/vim"
call mkdir($XDG_DATA_HOME."/vim/spell", 'p', 0700)

set backupdir=$XDG_STATE_HOME/vim/backup | call mkdir(&amp;backupdir, 'p', 0700)
set directory=$XDG_STATE_HOME/vim/swap   | call mkdir(&amp;directory, 'p', 0700)
set undodir=$XDG_STATE_HOME/vim/undo     | call mkdir(&amp;undodir,   'p', 0700)
set viewdir=$XDG_STATE_HOME/vim/view     | call mkdir(&amp;viewdir,   'p', 0700)

if !has('nvim') " Neovim has its own special location
  set viminfofile=$XDG_STATE_HOME/vim/viminfo
endif
</code></pre>

<h1 id="step-by-step">Step-by-step</h1>
<h2 id="relocating-vimrc">Relocating <em>vimrc</em></h2>

<p>To begin with, since version 7.3.1178, Vim will search for <code>~/.vim/vimrc</code> if
<code>~/.vimrc</code> is not found. So let's move the file there.</p>

<p>Let's move our <code>~/.vim</code> to <code>$XDG_CONFIG_HOME/vim</code>. Now we need to command Vim
to read config from this new location prior to <code>~/.vim</code>. There are three ways
to do it.</p>

<h3 id="shell-alias">Shell alias</h3>

<p>Pretty straightforward method. Shell will just substitute command <code>vim</code> with the alias body</p>

<pre><code class="language-sh">alias vim='vim -u ${XDG_CONFIG_HOME:-$HOME/.config}/vim/vimrc'
</code></pre>

<p>Downside? Works only in shell</p>

<h3 id="viminit-environmental-variable"><code>VIMINIT</code> environmental variable</h3>

<pre><code class="language-sh">export VIMINIT="set nocp | source ${XDG_CONFIG_HOME:-$HOME/.config}/vim/vimrc"
</code></pre>

<p>Cons? If you wish for Neovim and Vim configurations to still be separated, then:</p>

<pre><code class="language-sh">export VIMINIT="if has("nvim") | so ${XDG_CONFIG_HOME:-$HOME/.config}/nvim/init.vim | else | set nocp | so ${XDG_CONFIG_HOME:-$HOME/.config}/vim/vimrc | endif"
</code></pre>

<h3 id="wrapper-script">Wrapper script</h3>

<p>Save the following code as <code>vim</code> in <code>$HOME/.local/bin</code> *
and make is executable with <code>chmod +x vim</code></p>

<pre><code class="language-sh">#!/usr/bin/env sh

for dir in $(echo "$PATH" | tr ":" "\n" | grep -Fxv "$(dirname $0)"); do
    if [ -x "$dir/vim" ]; then
        exec "$dir/vim" -u "${XDG_CONFIG_HOME:-$HOME/.config}"/vim/vimrc "$@"
    fi
done
</code></pre>

<p>Doesn't affect Neovim and works outside shell, but you need to carry it together
with your config</p>

<p>* Remember to add it to the beginning of <code>PATH</code> environment variable. <br />
   It can be also other location of your choice instead of <code>$HOME/.local/bin</code></p>

<h2 id="now-the-code-in-our-vimrc">Now the code in our <em>vimrc</em></h2>

<p>First of all, although not mandatory, let's set <code>$MYVIMRC</code> variable:</p>
<pre><code class="language-vim">if empty($MYVIMRC) | let $MYVIMRC = expand('&lt;sfile&gt;:p') | endif
</code></pre>

<p>Let's define fallback locations in case <code>XDG_*</code> variables are not set.</p>
<pre><code class="language-vim">if empty($XDG_CACHE_HOME)  | let $XDG_CACHE_HOME  = $HOME."/.cache"       | endif
if empty($XDG_CONFIG_HOME) | let $XDG_CONFIG_HOME = $HOME."/.config"      | endif
if empty($XDG_DATA_HOME)   | let $XDG_DATA_HOME   = $HOME."/.local/share" | endif
if empty($XDG_STATE_HOME)  | let $XDG_STATE_HOME  = $HOME."/.local/state" | endif
</code></pre>

<p>Let's add entries to <code>runtimepath</code>:</p>
<pre><code class="language-vim">set runtimepath^=$XDG_CONFIG_HOME/vim
set runtimepath+=$XDG_DATA_HOME/vim
set runtimepath+=$XDG_CONFIG_HOME/vim/after
</code></pre>

<p><code>$XDG_CONFIG_HOME/vim</code> and <code>$XDG_CONFIG_HOME/vim/after</code> are just equivalents of
<code>~/.vim</code> and <code>~/.vim/after</code>, but <code>$XDG_DATA_HOME/vim</code> is brand new - there we
will keep downloadables (like plugins and spell files), Netrw bookmarks etc.</p>

<p>Let's set directory for Vim8 build-in packages:</p>
<pre><code class="language-vim">set packpath^=$XDG_DATA_HOME/vim
set packpath+=$XDG_DATA_HOME/vim/after
</code></pre>

<p>Netrw is just as easy:</p>
<pre><code class="language-vim">let g:netrw_home = $XDG_DATA_HOME."/vim"
</code></pre>

<p>What about spellings? Well, this one is more tricky, because it isn't controlled
by any option. Instead it searches for <code>spell</code> directory in whole runtime path.
If none is found then it falls back to <code>~/.vim/spell</code>. So let's create one at
desired location ourselves!</p>
<pre><code class="language-vim">call mkdir($XDG_DATA_HOME."/vim/spell", 'p', 0700)
</code></pre>

<p>So far so good. We are left with state (backup, undo, swap, viminfo, view).
Vim doesn't create directories for them (even for defaults), so we will need
to do it ourselves - thankfully VimL has <code>mkdir()</code> function.</p>
<pre><code class="language-vim">set backupdir=$XDG_STATE_HOME/vim/backup | call mkdir(&amp;backupdir, 'p', 0700)
set directory=$XDG_STATE_HOME/vim/swap   | call mkdir(&amp;directory, 'p', 0700)
set undodir=$XDG_STATE_HOME/vim/undo     | call mkdir(&amp;undodir,   'p', 0700)
set viewdir=$XDG_STATE_HOME/vim/view     | call mkdir(&amp;viewdir,   'p', 0700)

if !has('nvim') " Neovim has its own location which already complies with XDG specification
  set viminfofile=$XDG_STATE_HOME/vim/viminfo
endif
</code></pre>

<p>Congratulations! Now your Vim is configured with accordance to XDG Base Directory specification.</p>

<h1 id="sources">Sources</h1>
<ul>
  <li><a href="https://tlvince.com/vim-respect-xdg">Vim respect XDG</a></li>
  <li><a href="https://specifications.freedesktop.org/basedir-spec/0.8/">XDG Base Directory Specification</a></li>
  <li><a href="https://github.com/vim/vim/issues/2034">Issue #2034: [RFC] .config/vim(UNIX), AppData/Roaming/vim(Windows) directory structure</a></li>
  <li><a href="https://github.com/vim/vim/commit/6a459902592e2a4ba68">Version 7.3.1178 commit</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/XDG_Base_Directory">XDG Base Directory - ArchWiki</a></li>
  <li><a href="https://github.com/Jorengarenar/dotfiles/tree/master/vim">Jorengarenar's Vim config</a></li>
  <li><a href="https://groups.google.com/g/vim_dev/c/ieoldm29ymM/m/-dTZ2E8A1xwJ">[PATCH] XDG Base Directory Specification support</a></li>
</ul>


  </main>
  <footer>
    <span>Copyright &copy; Jorengarenar</span>
    <a href="/sitemap.xml"></a>
  </footer>
</body>
</html>
